<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Allied Framers - Image to PDF</title>
  <style>
    /* Basic layout */
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    header {
      background: #0d3b66;
      padding: 1rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    header img {
      max-height: 40px;
      width: auto;
    }
    header h1 {
      margin: 0;
      font-size: 1.25rem;
      color: white;
    }
    main {
      padding: 1.5rem;
    }
    p {
      margin: 0 0 1rem;
      line-height: 1.5;
    }
    #dropzone {
      border: 2px dashed #e95420;
      border-radius: 4px;
      padding: 1rem;
      background: #fcfcfc;
      text-align: center;
      color: #777;
      min-height: 180px;
      transition: background .2s, border-color .2s;
    }
    #dropzone.hover {
      border-color: #ff7f3f;
      background: #fffaf5;
    }
    #thumbnails {
      display: flex;
      flex-wrap: wrap;
      margin-top: 1rem;
    }
    .thumb-container {
      position: relative;
      margin: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      overflow: hidden;
    }
    .thumb-container img {
      display: block;
      max-width: 100px;
      height: auto;
    }
    .remove-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(255,255,255,0.9);
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      line-height: 18px;
      text-align: center;
      cursor: pointer;
      font-size: 14px;
      color: #e95420;
    }
    #status {
      margin-top: 1rem;
      font-weight: bold;
    }
    button#generate {
      display: block;
      margin: 1.5rem auto 0;
      background: #e95420;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background .2s;
    }
    button#generate:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button#generate:not(:disabled):hover {
      background: #ff7f3f;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="https://raw.githubusercontent.com/Allied-Framers-LLC/online/refs/heads/main/AF%2BLLC%2BCorp%2BLogo%2B-%2BCropped-211c13d6-1920w.png" alt="Allied Framers Logo">
      <h1>Image to PDF Converter</h1>
    </header>
    <main>
      <p>Paste your email (Ctrl+V) or drag-and-drop images below. Thumbnails will appear; click the √ó to remove any. When ready, click ‚ÄúGenerate PDF‚Äù to download.</p>
      <div id="dropzone" contenteditable="true">üìã Paste or drop images here</div>
      <div id="thumbnails"></div>
      <div id="status">No images yet</div>
      <button id="generate" disabled>Generate PDF</button>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script>
    const jsPDF = window.jspdf?.jsPDF || window.jsPDF;
    if (!jsPDF) throw new Error('jsPDF missing');

    const dz = document.getElementById('dropzone');
    const thumbs = document.getElementById('thumbnails');
    const status = document.getElementById('status');
    const btn = document.getElementById('generate');
    let images = [];

    function updateStatus() {
      status.textContent = images.length
        ? `${images.length} image(s) ready`
        : 'No images yet';
      btn.disabled = images.length === 0;
    }

    function addImageObj(obj) {
      if (images.some(i => i.dataURL === obj.dataURL)) return;
      images.push(obj);
      const wrapper = document.createElement('div');
      wrapper.className = 'thumb-container';
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '√ó';
      removeBtn.addEventListener('click', () => {
        images = images.filter(i => i.dataURL !== obj.dataURL);
        thumbs.removeChild(wrapper);
        updateStatus();
      });
      const thumb = document.createElement('img');
      thumb.src = obj.dataURL;
      wrapper.append(removeBtn, thumb);
      thumbs.appendChild(wrapper);
      updateStatus();
    }

    async function normalizeImage(srcOrFile) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = () => {
          const w = img.naturalWidth;
          const h = img.naturalHeight;
          const canvas = document.createElement('canvas');
          canvas.width = w;
          canvas.height = h;
          canvas.getContext('2d').drawImage(img, 0, 0);
          resolve({ dataURL: canvas.toDataURL('image/png'), width: w, height: h });
        };
        img.onerror = reject;
        if (srcOrFile instanceof File || srcOrFile instanceof Blob) {
          const reader = new FileReader();
          reader.onload = () => (img.src = reader.result);
          reader.readAsDataURL(srcOrFile);
        } else {
          img.src = srcOrFile;
        }
      });
    }

    dz.addEventListener('paste', async e => {
      e.preventDefault();
      for (let item of e.clipboardData.items) {
        if (item.kind === 'file' && item.type.startsWith('image/')) {
          addImageObj(await normalizeImage(item.getAsFile()));
        }
      }
      const html = e.clipboardData.getData('text/html');
      if (html) {
        const doc = new DOMParser().parseFromString(html, 'text/html');
        for (let imgEl of doc.querySelectorAll('img')) {
          const src = imgEl.src;
          try {
            if (src.startsWith('data:image/')) {
              addImageObj(await normalizeImage(src));
            } else if (src.startsWith('http')) {
              const res = await fetch(src, { mode: 'cors' });
              const blob = await res.blob();
              addImageObj(await normalizeImage(blob));
            }
          } catch {}
        }
      }
    });

    dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('hover'); });
    dz.addEventListener('dragleave', () => dz.classList.remove('hover'));
    dz.addEventListener('drop', async e => {
      e.preventDefault();
      dz.classList.remove('hover');
      for (let file of e.dataTransfer.files) {
        if (file.type.startsWith('image/')) addImageObj(await normalizeImage(file));
      }
    });

    btn.addEventListener('click', () => {
      if (!images.length) return;
      const first = images[0];
      const w1 = first.width;
      const h1 = first.height;
      const orient1 = w1 > h1 ? 'l' : 'p';
      const pdf = new jsPDF({ unit: 'px', format: [w1, h1], orientation: orient1, compress: true });
      pdf.addImage(first.dataURL, 'PNG', 0, 0, w1, h1);
      for (let i = 1; i < images.length; i++) {
        const img = images[i];
        const wi = img.width;
        const hi = img.height;
        const or = wi > hi ? 'l' : 'p';
        pdf.addPage([wi, hi], or);
        pdf.addImage(img.dataURL, 'PNG', 0, 0, wi, hi);
      }
      pdf.save('alliedframers-images.pdf');
    });
  </script>
</body>
</html>
